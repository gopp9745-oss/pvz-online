<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üå± Plants vs Zombies Online</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* TUTORIAL STYLES */
    .tutorial-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
    }
    .tutorial-card {
      background: #fff; border-radius: 20px; padding: 40px;
      max-width: 560px; width: 90%; position: relative;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .tutorial-step-indicator {
      display: flex; gap: 8px; justify-content: center; margin-bottom: 20px;
    }
    .tutorial-dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: #ddd; transition: background 0.3s;
    }
    .tutorial-dot.active { background: #4CAF50; }
    .tutorial-dot.done { background: #A5D6A7; }
    .tutorial-step-icon { font-size: 64px; text-align: center; margin-bottom: 15px; }
    .tutorial-step-title { font-size: 22px; font-weight: 700; color: #2E7D32; margin-bottom: 10px; text-align: center; }
    .tutorial-step-text { color: #555; font-size: 15px; line-height: 1.6; margin-bottom: 20px; }
    .tutorial-step-text ul { padding-left: 20px; margin-top: 8px; }
    .tutorial-step-text li { margin-bottom: 6px; }
    .tutorial-nav { display: flex; gap: 10px; justify-content: space-between; align-items: center; }
    .tutorial-counter { color: #999; font-size: 14px; }
    .tutorial-highlight { background: #E8F5E9; border-left: 4px solid #4CAF50; padding: 10px 15px; border-radius: 0 8px 8px 0; margin: 10px 0; font-size: 14px; }
    .tutorial-tip { background: #FFF9C4; border-left: 4px solid #FFD700; padding: 10px 15px; border-radius: 0 8px 8px 0; margin: 10px 0; font-size: 14px; }
  </style>
</head>
<body class="main-bg">

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
  <div id="screen-menu" class="screen active">

    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
    <div class="menu-bg-animated">
      <div class="menu-bg-layer layer1"></div>
      <div class="menu-bg-layer layer2"></div>
      <div class="menu-bg-layer layer3"></div>
    </div>

    <!-- –ü–ª–∞–≤–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ–Ω–∞ -->
    <div class="bg-floats">
      <span class="float-item" style="left:3%;top:70%;animation-delay:0s;font-size:40px;">&#x1F331;</span>
      <span class="float-item" style="left:8%;top:60%;animation-delay:0.4s;font-size:36px;">&#x1F33B;</span>
      <span class="float-item" style="left:14%;top:75%;animation-delay:0.8s;font-size:44px;">&#x1F335;</span>
      <span class="float-item" style="left:20%;top:65%;animation-delay:1.2s;font-size:38px;">&#x1F33A;</span>
      <span class="float-item" style="left:72%;top:72%;animation-delay:0.2s;font-size:38px;">&#x1F9DF;</span>
      <span class="float-item" style="left:80%;top:62%;animation-delay:0.6s;font-size:42px;">&#x1F9DF;&#x200D;&#x2642;&#xFE0F;</span>
      <span class="float-item" style="left:88%;top:70%;animation-delay:1.0s;font-size:36px;">&#x1FA78;</span>
      <span class="float-item" style="left:93%;top:60%;animation-delay:1.4s;font-size:40px;">&#x1F9DF;</span>
    </div>

    <div class="menu-main">

      <!-- –õ–û–ì–û–¢–ò–ü -->
      <div class="menu-logo">
        <div class="logo-icon-row">
          <span class="logo-plant">&#x1F331;</span>
          <span class="logo-vs">VS</span>
          <span class="logo-zombie">&#x1F9DF;</span>
        </div>
        <h1 class="logo-title">Plants vs Zombies</h1>
        <p class="logo-subtitle">&#x1F30D; Online Battle</p>
      </div>

      <!-- –ì–û–°–¢–¨: –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ -->
      <div id="guest-buttons" class="guest-panel">
        <div class="guest-btns">
          <button class="menu-btn menu-btn-primary" onclick="showScreen('screen-login')">
            <span class="menu-btn-icon">&#x1F511;</span>
            <span class="menu-btn-text">–í–æ–π—Ç–∏</span>
          </button>
          <button class="menu-btn menu-btn-success" onclick="showScreen('screen-register')">
            <span class="menu-btn-icon">&#x1F4DD;</span>
            <span class="menu-btn-text">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
          </button>
          <button class="menu-btn menu-btn-info" onclick="showLeaderboard()">
            <span class="menu-btn-icon">&#x1F3C6;</span>
            <span class="menu-btn-text">–õ–∏–¥–µ—Ä—ã</span>
          </button>
          <button class="menu-btn menu-btn-warning" onclick="startTutorial()">
            <span class="menu-btn-icon">&#x1F4D6;</span>
            <span class="menu-btn-text">–û–±—É—á–µ–Ω–∏–µ</span>
          </button>
        </div>
      </div>

      <!-- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨: –ø–∞–Ω–µ–ª—å -->
      <div id="user-panel" class="user-panel hidden">

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞ -->
        <div class="player-card">
        <div class="player-card-avatar" id="menu-avatar">&#x1F3AE;</div>
          <div class="player-card-info">
            <div class="player-card-name" id="menu-username">–ò–≥—Ä–æ–∫</div>
            <div class="player-card-stats">
              <div class="stat-chip coins-chip">
                <span>&#x1FA99;</span>
                <span id="menu-coins">0</span>
              </div>
              <div class="stat-chip wins-chip">
                <span>&#x1F3C6;</span>
                <span id="menu-wins">0</span>
              </div>
            </div>
            <!-- –®–∫–∞–ª–∞ —É—Ä–æ–≤–Ω—è -->
            <div class="menu-level-bar-wrap">
              <div class="menu-level-label" id="menu-xp-label">–£—Ä. 1 ¬∑ 0/100 XP</div>
              <div class="menu-level-bar">
                <div class="menu-level-fill" id="menu-xp-fill" style="width:0%"></div>
              </div>
            </div>
          </div>
          <button class="player-card-logout" onclick="logout()" title="–í—ã–π—Ç–∏">&#x1F6AA;</button>
        </div>

        <!-- –°–æ–±—ã—Ç–∏—è -->
        <div id="events-display"></div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
        <div class="main-action-btns">
          <button class="play-btn" onclick="findGame()">
            <span class="play-btn-icon">&#x2694;&#xFE0F;</span>
            <span class="play-btn-text">–ù–∞–π—Ç–∏ –∏–≥—Ä—É</span>
            <span class="play-btn-sub">PvP –æ–Ω–ª–∞–π–Ω</span>
          </button>
          <button class="play-btn play-btn-bot" onclick="showBotMenu()">
            <span class="play-btn-icon">&#x1F916;</span>
            <span class="play-btn-text">–ü—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞</span>
            <span class="play-btn-sub">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
          </button>
        </div>

        <!-- –í—Ç–æ—Ä–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
        <div class="secondary-btns">
          <button class="sec-btn" onclick="showShop()">
            <span>&#x1F6D2;</span> –ú–∞–≥–∞–∑–∏–Ω
          </button>
          <button class="sec-btn" onclick="showInventory()">
            <span>&#x1F392;</span> –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
          </button>
          <button class="sec-btn" onclick="showProfile()">
            <span>&#x1F464;</span> –ü—Ä–æ—Ñ–∏–ª—å
          </button>
          <button class="sec-btn" onclick="showFriends()">
            <span>&#x1F91D;</span> –î—Ä—É–∑—å—è <span id="friends-badge" class="badge hidden">0</span>
          </button>
          <button class="sec-btn" onclick="showLeaderboard()">
            <span>&#x1F3C6;</span> –õ–∏–¥–µ—Ä—ã
          </button>
          <button class="sec-btn" onclick="showRewardsPath()">
            <span>&#x1F381;</span> –ù–∞–≥—Ä–∞–¥—ã
          </button>
          <button class="sec-btn" onclick="startTutorial()">
            <span>&#x1F4D6;</span> –û–±—É—á–µ–Ω–∏–µ
          </button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="admin-btns-row">
          <button id="admin-btn" class="admin-panel-btn hidden" onclick="window.location.href='admin.html'">
            &#x1F451; Admin Panel
          </button>
          <button id="mod-btn" class="mod-panel-btn hidden" onclick="window.location.href='mod.html'">
            &#x1F6E1; Mod Panel
          </button>
          <button id="claim-admin-btn" class="claim-btn hidden" onclick="showClaimAdmin()">
            &#x1F511; –°—Ç–∞—Ç—å –∞–¥–º–∏–Ω–æ–º
          </button>
        </div>

      </div>
    </div>
  </div>

  <div id="screen-login" class="screen">
    <div class="auth-container">
      <div class="auth-card">
        <h2>üîë –í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h2>
        <div class="form-group">
          <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
          <input type="text" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è..." class="input-field">
        </div>
        <div class="form-group">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input type="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." class="input-field">
        </div>
        <div id="login-error" class="error-msg hidden"></div>
        <div class="form-buttons">
          <button class="btn btn-primary" onclick="doLogin()">–í–æ–π—Ç–∏</button>
          <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–∞–∑–∞–¥</button>
        </div>
        <p class="auth-link">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showScreen('screen-register')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
      </div>
    </div>
  </div>

  <!-- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
  <div id="screen-register" class="screen">
    <div class="auth-container">
      <div class="auth-card">
        <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <div class="form-group">
          <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–∏–Ω. 3 —Å–∏–º–≤–æ–ª–∞)</label>
          <input type="text" id="reg-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è..." class="input-field">
        </div>
        <div class="form-group">
          <label>–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 4 —Å–∏–º–≤–æ–ª–∞)</label>
          <input type="password" id="reg-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å..." class="input-field">
        </div>
        <div class="form-group">
          <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
          <input type="password" id="reg-password2" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." class="input-field">
        </div>
        <div id="reg-error" class="error-msg hidden"></div>
        <div id="reg-success" class="success-msg hidden"></div>
        <div class="form-buttons">
          <button class="btn btn-success" onclick="doRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
          <button class="btn btn-secondary" onclick="showScreen('screen-menu')">–ù–∞–∑–∞–¥</button>
        </div>
        <p class="auth-link">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showScreen('screen-login')">–í–æ–π—Ç–∏</a></p>
      </div>
    </div>
  </div>

  <!-- –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í -->
  <div id="screen-leaderboard" class="screen">
    <div class="leaderboard-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" onclick="showScreen('screen-menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
      </div>
      <div class="leaderboard-tabs">
        <button class="tab-btn active" onclick="switchLeaderTab('wins', this)">–ü–æ –ø–æ–±–µ–¥–∞–º</button>
        <button class="tab-btn" onclick="switchLeaderTab('coins', this)">–ü–æ –º–æ–Ω–µ—Ç–∞–º</button>
      </div>
      <div id="leaderboard-list" class="leaderboard-list">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </div>
  </div>

  <!-- –ú–ê–ì–ê–ó–ò–ù -->
  <div id="screen-shop" class="screen">
    <div class="shop-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" onclick="showScreen('screen-menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
        <div class="coins-display">ü™ô <span id="shop-coins">0</span></div>
      </div>

      <!-- –¢–∞–π–º–µ—Ä —Ä–æ—Ç–∞—Ü–∏–∏ -->
      <div id="shop-timer-display" class="shop-timer-bar"></div>

      <!-- –í–∫–ª–∞–¥–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ -->
      <div class="shop-tabs">
        <button class="tab-btn active" onclick="filterShop('all', this)">üè™ –í—Å–µ</button>
        <button class="tab-btn" onclick="filterShop('plant', this)">üå± –†–∞—Å—Ç–µ–Ω–∏—è</button>
        <button class="tab-btn" onclick="filterShop('zombie', this)">üßü –ó–æ–º–±–∏</button>
        <button class="tab-btn" onclick="filterShop('skin', this)">‚ú® –°–∫–∏–Ω—ã</button>
        <button class="tab-btn shop-promo-tab" onclick="showShopPromo(this)">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã</button>
      </div>

      <!-- –¢–æ–≤–∞—Ä—ã -->
      <div id="shop-items" class="shop-grid"></div>

      <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ -->
      <div id="shop-promo-panel" style="display:none">
        <div class="promo-card">
          <div class="promo-card-header">
            <span class="promo-card-icon">üéÅ</span>
            <div>
              <h3>–ü—Ä–æ–º–æ–∫–æ–¥—ã</h3>
              <p>–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –∏ –ø–æ–ª—É—á–∏—Ç–µ –º–æ–Ω–µ—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ!</p>
            </div>
          </div>

          <div class="promo-input-row" style="margin-bottom:12px">
            <input type="text" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥..." class="input-field" style="text-transform:uppercase">
            <button class="btn btn-success" onclick="usePromo()">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          </div>
          <div id="promo-result" class="hidden"></div>

          <div class="promo-tg-banner">
            <div class="promo-tg-left">
              <span style="font-size:36px">üì¢</span>
              <div>
                <div style="font-weight:700;font-size:16px;color:#fff;margin-bottom:4px">–ü–æ–ª—É—á–∞–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ!</div>
                <div style="font-size:13px;color:rgba(255,255,255,0.8)">–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à Telegram-–∫–∞–Ω–∞–ª ‚Äî —Ç–∞–º –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã –Ω–∞ –º–æ–Ω–µ—Ç—ã –∏ –±–æ–Ω—É—Å—ã!</div>
              </div>
            </div>
            <a href="https://t.me/team_grim" target="_blank" class="btn-tg">
              <span>‚úàÔ∏è</span> –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
            </a>
          </div>

          <div class="promo-tips">
            <div class="promo-tip-item">üí° –ü—Ä–æ–º–æ–∫–æ–¥—ã –¥–∞—é—Ç –æ—Ç 50 –¥–æ 1000 –º–æ–Ω–µ—Ç</div>
            <div class="promo-tip-item">‚è∞ –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</div>
            <div class="promo-tip-item">üîí –ö–∞–∂–¥—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ò–ù–í–ï–ù–¢–ê–†–¨ -->
  <div id="screen-inventory" class="screen">
    <div class="shop-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" onclick="showScreen('screen-menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
        <div class="coins-display">ü™ô <span id="inv-coins">0</span></div>
      </div>

      <div class="shop-tabs">
        <button class="tab-btn active" onclick="filterInventory('all', this)">–í—Å–µ</button>
        <button class="tab-btn" onclick="filterInventory('plant', this)">üå± –†–∞—Å—Ç–µ–Ω–∏—è</button>
        <button class="tab-btn" onclick="filterInventory('zombie', this)">üßü –ó–æ–º–±–∏</button>
        <button class="tab-btn" onclick="filterInventory('skin', this)">‚ú® –°–∫–∏–Ω—ã</button>
      </div>

      <div id="inventory-items" class="shop-grid">
        <div class="empty-state">
          <div class="empty-state-icon">üéí</div>
          <p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
          <button class="btn btn-primary btn-sm" onclick="showShop()">–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –î–†–£–ó–¨–Ø -->
  <div id="screen-friends" class="screen">
    <div class="shop-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" onclick="showScreen('screen-menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>ü§ù –î—Ä—É–∑—å—è</h2>
      </div>

      <!-- –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞ -->
      <div class="promo-section">
        <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h3>
        <div class="promo-input-row">
          <input type="text" id="friend-username-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏–≥—Ä–æ–∫–∞..." class="input-field">
          <button class="btn btn-success" onclick="sendFriendRequest()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div id="friend-add-result" class="hidden" style="margin-top:8px"></div>
      </div>

      <!-- –í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã -->
      <div id="friend-requests-section" style="margin-bottom:16px;display:none">
        <h3 style="color:#FF9800;margin-bottom:8px">üì® –í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
        <div id="friend-requests-list"></div>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π -->
      <h3 style="margin-bottom:8px">üë• –ú–æ–∏ –¥—Ä—É–∑—å—è</h3>
      <div id="friends-list" class="shop-grid">
        <div class="empty-state">
          <div class="empty-state-icon">ü§ù</div>
          <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
          <p style="font-size:13px;color:#888">–î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∞ –ø–æ –Ω–∏–∫—É –≤—ã—à–µ</p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –í–´–ó–û–í –ù–ê –ë–û–ô -->
  <div id="modal-challenge" class="modal" style="display:none">
    <div class="modal-content" style="background:#fff;color:#333;max-width:400px;text-align:center">
      <div style="font-size:48px;margin-bottom:10px">‚öîÔ∏è</div>
      <h3 style="color:#E53935;margin-bottom:8px">–í—ã–∑–æ–≤ –Ω–∞ –±–æ–π!</h3>
      <p id="challenge-from-text" style="color:#555;margin-bottom:20px">–ò–≥—Ä–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞—Å –Ω–∞ –¥—Ä—É–∂–µ—Å–∫–∏–π –±–æ–π!</p>
      <div class="modal-buttons" style="justify-content:center">
        <button class="btn btn-success" onclick="acceptChallenge()">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
        <button class="btn btn-danger" onclick="declineChallenge()">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–û–ô –ü–†–û–§–ò–õ–¨ -->
  <div id="screen-profile" class="screen">
    <div class="shop-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" onclick="showScreen('screen-menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
      </div>
      <div class="profile-card">
        <!-- –ê–≤–∞—Ç–∞—Ä -->
        <div class="profile-avatar-section">
          <div class="profile-avatar-big" id="profile-avatar-display">üéÆ</div>
          <div class="profile-avatar-label">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä:</div>
          <div class="avatar-picker" id="avatar-picker">
            <span onclick="selectAvatar('üéÆ')">üéÆ</span><span onclick="selectAvatar('üå±')">üå±</span>
            <span onclick="selectAvatar('üßü')">üßü</span><span onclick="selectAvatar('üèÜ')">üèÜ</span>
            <span onclick="selectAvatar('‚öîÔ∏è')">‚öîÔ∏è</span><span onclick="selectAvatar('üî•')">üî•</span>
            <span onclick="selectAvatar('üíé')">üíé</span><span onclick="selectAvatar('üëë')">üëë</span>
            <span onclick="selectAvatar('üêâ')">üêâ</span><span onclick="selectAvatar('üåª')">üåª</span>
            <span onclick="selectAvatar('üçí')">üçí</span><span onclick="selectAvatar('‚ùÑÔ∏è')">‚ùÑÔ∏è</span>
            <span onclick="selectAvatar('ü§ñ')">ü§ñ</span><span onclick="selectAvatar('ü•∑')">ü•∑</span>
            <span onclick="selectAvatar('ü¶ä')">ü¶ä</span><span onclick="selectAvatar('üê∫')">üê∫</span>
          </div>
        </div>
        <!-- –î–∞–Ω–Ω—ã–µ -->
        <div class="profile-fields">
          <div class="form-group">
            <label style="color:#fff">–ù–∏–∫–Ω–µ–π–º</label>
            <input type="text" id="profile-username-input" class="input-field" placeholder="–í–∞—à –Ω–∏–∫...">
          </div>
          <div class="form-group">
            <label style="color:#fff">–û —Å–µ–±–µ (–º–∞–∫—Å. 150 —Å–∏–º–≤–æ–ª–æ–≤)</label>
            <textarea id="profile-bio-input" class="input-field" rows="3" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..." style="resize:none"></textarea>
          </div>
          <button class="btn btn-success" onclick="saveProfile()" style="width:100%">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        </div>
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="profile-stats-grid">
          <div class="profile-stat"><div class="profile-stat-val" id="ps-wins">0</div><div class="profile-stat-lbl">üèÜ –ü–æ–±–µ–¥—ã</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="ps-losses">0</div><div class="profile-stat-lbl">üíÄ –ü–æ—Ä–∞–∂–µ–Ω–∏—è</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="ps-coins">0</div><div class="profile-stat-lbl">ü™ô –ú–æ–Ω–µ—Ç—ã</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="ps-level">1</div><div class="profile-stat-lbl">‚≠ê –£—Ä–æ–≤–µ–Ω—å</div></div>
        </div>
        <!-- –£—Ä–æ–≤–µ–Ω—å -->
        <div class="profile-xp-bar-wrap">
          <div class="profile-xp-label">–£—Ä–æ–≤–µ–Ω—å <span id="ps-level2">1</span> ¬∑ <span id="ps-xp">0</span> / <span id="ps-xpnext">100</span> XP</div>
          <div class="profile-xp-bar"><div class="profile-xp-fill" id="ps-xp-fill" style="width:0%"></div></div>
        </div>
        <!-- –ó–Ω–∞—á–∫–∏ -->
        <div id="profile-badges-section" style="margin-top:16px">
          <div style="color:#FFD700;font-weight:700;margin-bottom:8px">üèÖ –ó–Ω–∞—á–∫–∏</div>
          <div id="profile-badges-list" class="badges-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü–†–û–°–ú–û–¢–† –ü–†–û–§–ò–õ–Ø –î–†–£–ì–û–ì–û –ò–ì–†–û–ö–ê -->
  <div id="screen-view-profile" class="screen">
    <div class="shop-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" id="view-profile-back-btn" onclick="showScreen('screen-leaderboard')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞</h2>
      </div>
      <div class="profile-card">
        <div style="text-align:center;margin-bottom:20px">
          <div class="profile-avatar-big" id="vp-avatar">üéÆ</div>
          <div style="font-size:24px;font-weight:800;color:#fff;margin:10px 0" id="vp-username">–ò–≥—Ä–æ–∫</div>
          <div id="vp-badges-row" style="display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:8px"></div>
          <div style="color:rgba(255,255,255,0.7);font-size:14px" id="vp-bio"></div>
        </div>
        <div class="profile-stats-grid">
          <div class="profile-stat"><div class="profile-stat-val" id="vp-wins">0</div><div class="profile-stat-lbl">üèÜ –ü–æ–±–µ–¥—ã</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="vp-losses">0</div><div class="profile-stat-lbl">üíÄ –ü–æ—Ä–∞–∂–µ–Ω–∏—è</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="vp-coins">0</div><div class="profile-stat-lbl">ü™ô –ú–æ–Ω–µ—Ç—ã</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="vp-level">1</div><div class="profile-stat-lbl">‚≠ê –£—Ä–æ–≤–µ–Ω—å</div></div>
        </div>
        <div class="profile-xp-bar-wrap">
          <div class="profile-xp-label">–£—Ä–æ–≤–µ–Ω—å <span id="vp-level2">1</span> ¬∑ <span id="vp-xp">0</span> / <span id="vp-xpnext">100</span> XP</div>
          <div class="profile-xp-bar"><div class="profile-xp-fill" id="vp-xp-fill" style="width:0%"></div></div>
        </div>
        <div id="vp-badges-section" style="margin-top:16px">
          <div style="color:#FFD700;font-weight:700;margin-bottom:8px">üèÖ –ó–Ω–∞—á–∫–∏</div>
          <div id="vp-badges-list" class="badges-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü–£–¢–¨ –ù–ê–ì–†–ê–î -->
  <div id="screen-rewards-path" class="screen">
    <div class="shop-container">
      <div class="page-header">
        <button class="btn btn-secondary btn-back" onclick="showScreen('screen-menu')">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üéÅ –ü—É—Ç—å –Ω–∞–≥—Ä–∞–¥</h2>
        <div class="coins-display" id="rp-level-display">–£—Ä. 1</div>
      </div>
      <div id="rewards-path-content"></div>
    </div>
  </div>

  <!-- –ü–û–ò–°–ö –ò–ì–†–´ -->
  <div id="screen-searching" class="screen">
    <div class="searching-container">
      <div class="searching-card">
        <div class="searching-animation">
          <span>üå±</span>
          <div class="dots"><span>.</span><span>.</span><span>.</span></div>
          <span>üßü</span>
        </div>
        <h2>–ü–æ–∏—Å–∫ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...</h2>
        <p>–û–∂–∏–¥–∞–µ–º –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞</p>
        <p style="color:#FF9800;font-size:14px;margin-top:4px">‚è± <span id="search-timer">0—Å</span> ¬∑ –ß–µ—Ä–µ–∑ 60—Å ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–æ—Ç</p>
        <button class="btn btn-danger" onclick="cancelSearch()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
  <div id="toast" class="toast hidden"></div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ö–û–î –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê -->
  <div id="modal-claim-admin" class="modal" style="display:none">
    <div class="modal-content" style="background:#fff;color:#333">
      <h3 style="color:#2E7D32">üîë –ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
      <p style="color:#666;margin-bottom:15px">–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
      <div class="form-group">
        <label style="color:#333">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥</label>
        <input type="password" id="admin-secret-input" class="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥...">
      </div>
      <div id="claim-admin-result" style="display:none;margin-bottom:10px"></div>
      <div class="modal-buttons">
        <button class="btn btn-success" onclick="doClaimAdmin()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button class="btn btn-secondary" onclick="document.getElementById('modal-claim-admin').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –ò–ì–†–ê –° –ë–û–¢–û–ú -->
  <div id="modal-bot" class="modal" style="display:none">
    <div class="modal-content" style="background:#fff;color:#333;max-width:480px">
      <h3 style="color:#2E7D32;margin-bottom:15px">ü§ñ –ò–≥—Ä–∞ —Å –±–æ—Ç–æ–º</h3>
      <div class="form-group">
        <label style="color:#333">–í–∞—à–∞ —Ä–æ–ª—å</label>
        <div style="display:flex;gap:10px;margin-top:8px">
          <button id="bot-role-plant" class="btn btn-success" onclick="selectBotRole('plant',this)" style="flex:1">üå± –†–∞—Å—Ç–µ–Ω–∏—è</button>
          <button id="bot-role-zombie" class="btn btn-secondary" onclick="selectBotRole('zombie',this)" style="flex:1">üßü –ó–æ–º–±–∏</button>
        </div>
      </div>
      <div class="form-group" style="margin-top:15px">
        <label style="color:#333">–°–ª–æ–∂–Ω–æ—Å—Ç—å –±–æ—Ç–∞</label>
        <div style="display:flex;gap:10px;margin-top:8px">
          <button id="bot-diff-easy" class="btn btn-success" onclick="selectBotDiff('easy',this)" style="flex:1">üòä –õ—ë–≥–∫–∏–π</button>
          <button id="bot-diff-medium" class="btn btn-secondary" onclick="selectBotDiff('medium',this)" style="flex:1">üòê –°—Ä–µ–¥–Ω–∏–π</button>
          <button id="bot-diff-hard" class="btn btn-secondary" onclick="selectBotDiff('hard',this)" style="flex:1">üòà –°–ª–æ–∂–Ω—ã–π</button>
        </div>
      </div>
      <div style="background:#E8F5E9;border-radius:8px;padding:12px;margin:15px 0;font-size:13px;color:#2E7D32">
        üí° –ò–≥—Ä–∞ —Å –±–æ—Ç–æ–º –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–±–µ–¥/–ø–æ—Ä–∞–∂–µ–Ω–∏–π
      </div>
      <div class="modal-buttons">
        <button class="btn btn-primary" onclick="startBotGame()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button class="btn btn-secondary" onclick="document.getElementById('modal-bot').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <!-- –û–ë–£–ß–ï–ù–ò–ï -->
  <div id="tutorial-overlay" class="tutorial-overlay" style="display:none">
    <div class="tutorial-card">
      <div class="tutorial-step-indicator" id="tutorial-dots"></div>
      <div id="tutorial-step-content"></div>
      <div class="tutorial-nav">
        <button class="btn btn-secondary btn-sm" id="tutorial-prev-btn" onclick="tutorialPrev()">‚Üê –ù–∞–∑–∞–¥</button>
        <span class="tutorial-counter" id="tutorial-counter"></span>
        <button class="btn btn-primary btn-sm" id="tutorial-next-btn" onclick="tutorialNext()">–î–∞–ª–µ–µ ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ –°–û–ë–´–¢–ò–Ø -->
  <div id="community-event-panel" class="community-event-panel">
    <div class="cev-header">
      <span class="cev-badge">üî¥ LIVE</span>
      <span class="cev-title">–°–æ–±—ã—Ç–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</span>
      <button class="cev-close" onclick="toggleEventPanel()">‚úï</button>
    </div>
    <div class="cev-body">
      <div class="cev-event-icon">üéÆ</div>
      <div class="cev-event-name">üöÄ –†–µ–ª–∏–∑ –∏–≥—Ä—ã!</div>
      <div class="cev-event-desc">–û—Ç–º–µ—á–∞–µ–º –∑–∞–ø—É—Å–∫ Plants vs Zombies Online! –°—ã–≥—Ä–∞–π—Ç–µ –º–∞—Ç—á–∏ –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º –∏ –ø–æ–ª—É—á–∏—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã!</div>

      <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ–±—ã—Ç–∏—è -->
      <div class="cev-progress-wrap">
        <div class="cev-progress-label">
          <span>–ü–æ–±–µ–¥ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</span>
          <span id="cev-wins-count">0 / 100</span>
        </div>
        <div class="cev-progress-bar">
          <div class="cev-progress-fill" id="cev-progress-fill" style="width:0%"></div>
        </div>
      </div>

      <!-- –ù–∞–≥—Ä–∞–¥—ã -->
      <div class="cev-rewards-title">üéÅ –ù–∞–≥—Ä–∞–¥—ã –∑–∞ —É—á–∞—Å—Ç–∏–µ:</div>
      <div class="cev-rewards-list">
        <div class="cev-reward-item">
          <span class="cev-reward-icon">ü™ô</span>
          <div>
            <div class="cev-reward-name">500 –º–æ–Ω–µ—Ç</div>
            <div class="cev-reward-desc">–í—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º</div>
          </div>
          <span class="cev-reward-check" id="cev-r1">üîí</span>
        </div>
        <div class="cev-reward-item">
          <span class="cev-reward-icon">üå∏</span>
          <div>
            <div class="cev-reward-name">–°–∫–∏–Ω "–†–æ–∑–æ–≤—ã–π –≥–æ—Ä–æ—Ö"</div>
            <div class="cev-reward-desc">–ó–∞ 1+ –ø–æ–±–µ–¥—É</div>
          </div>
          <span class="cev-reward-check" id="cev-r2">üîí</span>
        </div>
        <div class="cev-reward-item">
          <span class="cev-reward-icon">üèÜ</span>
          <div>
            <div class="cev-reward-name">–ó–Ω–∞—á–æ–∫ "–ü–µ—Ä–≤–æ–ø—Ä–æ—Ö–æ–¥–µ—Ü"</div>
            <div class="cev-reward-desc">–¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤</div>
          </div>
          <span class="cev-reward-check" id="cev-r3">üîí</span>
        </div>
        <div class="cev-reward-item">
          <span class="cev-reward-icon">üü†</span>
          <div>
            <div class="cev-reward-name">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Å–∫–∏–Ω</div>
            <div class="cev-reward-desc">–ü—Ä–∏ 100 –ø–æ–±–µ–¥–∞—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</div>
          </div>
          <span class="cev-reward-check" id="cev-r4">üîí</span>
        </div>
      </div>

      <!-- –¢–∞–π–º–µ—Ä -->
      <div class="cev-timer">
        <span>‚è∞ –î–æ –∫–æ–Ω—Ü–∞ —Å–æ–±—ã—Ç–∏—è:</span>
        <span class="cev-timer-val" id="cev-timer">7–¥ 00:00:00</span>
      </div>

      <button class="cev-play-btn" onclick="document.getElementById('community-event-panel').classList.remove('open');findGame&&currentUser?findGame():showScreen('screen-login')">
        ‚öîÔ∏è –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å!
      </button>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ —Å–æ–±—ã—Ç–∏—è -->
  <button class="cev-toggle-btn" id="cev-toggle-btn" onclick="toggleEventPanel()" title="–°–æ–±—ã—Ç–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞">
    <span class="cev-toggle-icon">üéÆ</span>
    <span class="cev-toggle-label">–°–æ–±—ã—Ç–∏–µ</span>
    <span class="cev-toggle-live">LIVE</span>
  </button>

  <script src="/socket.io/socket.io.js"></script>
  <script src="app.js"></script>
  <script src="bot.js"></script>
  <script>
  // ===== COMMUNITY EVENT PANEL =====
  var eventPanelOpen = false;
  var eventEndTime = Date.now() + 7 * 24 * 60 * 60 * 1000; // 7 –¥–Ω–µ–π

  function toggleEventPanel() {
    eventPanelOpen = !eventPanelOpen;
    var panel = document.getElementById('community-event-panel');
    var btn = document.getElementById('cev-toggle-btn');
    if (eventPanelOpen) {
      panel.classList.add('open');
      btn.classList.add('active');
    } else {
      panel.classList.remove('open');
      btn.classList.remove('active');
    }
  }

  // –¢–∞–π–º–µ—Ä —Å–æ–±—ã—Ç–∏—è
  function updateEventTimer() {
    var left = Math.max(0, eventEndTime - Date.now());
    var d = Math.floor(left / 86400000);
    var h = Math.floor((left % 86400000) / 3600000);
    var m = Math.floor((left % 3600000) / 60000);
    var s = Math.floor((left % 60000) / 1000);
    var el = document.getElementById('cev-timer');
    if (el) el.textContent = d + '–¥ ' + pad(h) + ':' + pad(m) + ':' + pad(s);
  }
  function pad(n) { return n < 10 ? '0' + n : n; }
  setInterval(updateEventTimer, 1000);
  updateEventTimer();

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–∑ —Å–æ–±—ã—Ç–∏–π —Å–µ—Ä–≤–µ—Ä–∞
  if (typeof socket !== 'undefined') {
    socket.on('events_data', function(events) {
      var releaseEvent = events && events.find(function(e) { return e.name && e.name.includes('–†–µ–ª–∏–∑'); });
      if (releaseEvent) {
        var pct = Math.min(100, Math.round((releaseEvent.currentWins || 0) / (releaseEvent.targetWins || 100) * 100));
        var fill = document.getElementById('cev-progress-fill');
        var cnt = document.getElementById('cev-wins-count');
        if (fill) fill.style.width = pct + '%';
        if (cnt) cnt.textContent = (releaseEvent.currentWins || 0) + ' / ' + (releaseEvent.targetWins || 100);
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –Ω–∞–≥—Ä–∞–¥—ã
        if (pct >= 25) { var r1 = document.getElementById('cev-r1'); if(r1) r1.textContent = '‚úÖ'; }
        if (pct >= 50) { var r2 = document.getElementById('cev-r2'); if(r2) r2.textContent = '‚úÖ'; }
        if (pct >= 75) { var r3 = document.getElementById('cev-r3'); if(r3) r3.textContent = '‚úÖ'; }
        if (pct >= 100) { var r4 = document.getElementById('cev-r4'); if(r4) r4.textContent = '‚úÖ'; }
      }
    });
    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(function() { socket.emit('get_events'); }, 1000);
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏
  if (!localStorage.getItem('pvz_event_seen')) {
    setTimeout(function() {
      toggleEventPanel();
      localStorage.setItem('pvz_event_seen', '1');
    }, 3000);
  }
  </script>
</body>
</html>
